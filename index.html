import React, { useState } from 'react';
import { Download, Zap, Wind } from 'lucide-react';

const SRB2CharacterGenerator = () => {
  const [charName, setCharName] = useState('Orange Sonic');
  const [downloading, setDownloading] = useState(false);

  const generateSOCFile = () => {
    return `# Orange Sonic - Dragon Ball Character Mod
# Custom character with Kamehameha, Spirit Bomb, and Flight abilities

Character ${charName.replace(/\s+/g, '')}
{
  Name = ${charName}
  Skincolor = SKIN_ORANGE
  Prefcolor = Orange
  Speed = 36
  Accel = 45
  Thrustfactor = 5
  Jumpfactor = 1.0
  Ability = CA_FLY
  Ability2 = CA_DOUBLEJUMP
  Normalspeed = 36
  Runspeed = 28
  Flags = SF_NOSKID|SF_RUNONWATER
  
  # Custom Dragon Ball Abilities
  # Press Custom 1 for Kamehameha
  # Press Custom 2 for Spirit Bomb
  # Press Jump twice to activate flight
}

# Kamehameha Attack State
State S_PLAY_KAMEHAMEHA
{
  SpriteFrame = A
  Duration = 35
  Next = S_PLAY_STND
  Action = A_FireShot
  Var1 = MT_THOK
  Var2 = 1
}

# Spirit Bomb State
State S_PLAY_SPIRITBOMB
{
  SpriteFrame = A
  Duration = 70
  Next = S_PLAY_STND
  Action = A_BossScream
  Var1 = MT_EGGMOBILE_FIRE
  Var2 = PC_HURT
}

# Flight ability - Enhanced duration
Object MT_TAILSOVERLAY_ORANGE
{
  Radius = 393216
  Height = 786432
  Flags = MF_NOBLOCKMAP|MF_NOCLIP|MF_NOCLIPHEIGHT|MF_NOGRAVITY
  SpawnState = S_TAILSOVERLAY_STAND
}

# Energy projectile for Kamehameha
Thing MT_KAMEHAMEHA_BLAST
{
  Radius = 16
  Height = 32
  Speed = 40
  Damage = 5
  RenderFlags = RF_FULLBRIGHT
  Flags = MF_NOGRAVITY|MF_MISSILE
  SpawnState = S_THOK
  DeathState = S_SPRK1
}

# Lua script hooks for custom abilities
LUAFILE "Lua/OrangeSonic.lua"`;
  };

  const generateLuaFile = () => {
    return `-- Orange Sonic Dragon Ball Abilities
-- Kamehameha, Spirit Bomb, and Flight mechanics

local kamehameha_cooldown = {}
local spiritbomb_cooldown = {}
local flight_power = {}

-- Initialize player data
addHook("PlayerSpawn", function(player)
    if player.mo and player.mo.skin == "orangesonic" then
        kamehameha_cooldown[player] = 0
        spiritbomb_cooldown[player] = 0
        flight_power[player] = 100
    end
end)

-- Kamehameha Attack (Custom Button 1)
addHook("PlayerThink", function(player)
    if not (player.mo and player.mo.skin == "orangesonic") then return end
    
    -- Decrease cooldowns
    if kamehameha_cooldown[player] > 0 then
        kamehameha_cooldown[player] = $ - 1
    end
    if spiritbomb_cooldown[player] > 0 then
        spiritbomb_cooldown[player] = $ - 1
    end
    
    -- Kamehameha (Custom 1)
    if player.cmd.buttons & BT_CUSTOM1 and kamehameha_cooldown[player] == 0 then
        local mo = P_SpawnMobj(player.mo.x, player.mo.y, player.mo.z + 32*FRACUNIT, MT_THOK)
        mo.angle = player.mo.angle
        P_InstaThrust(mo, mo.angle, 40*FRACUNIT)
        mo.momz = 0
        mo.flags = $|MF_MISSILE
        mo.color = SKINCOLOR_ORANGE
        
        S_StartSound(player.mo, sfx_s3k5d) -- Energy sound
        kamehameha_cooldown[player] = 35 -- 1 second cooldown
        
        P_SpawnMobj(player.mo.x, player.mo.y, player.mo.z, MT_THOK).color = SKINCOLOR_YELLOW
    end
    
    -- Spirit Bomb (Custom 2 - Hold for charge)
    if player.cmd.buttons & BT_CUSTOM2 and spiritbomb_cooldown[player] == 0 then
        -- Charge effect
        if leveltime % 4 == 0 then
            local sparkle = P_SpawnMobj(
                player.mo.x + P_RandomRange(-64, 64)*FRACUNIT,
                player.mo.y + P_RandomRange(-64, 64)*FRACUNIT,
                player.mo.z + P_RandomRange(0, 96)*FRACUNIT,
                MT_SPARK
            )
            sparkle.color = SKINCOLOR_CYAN
        end
        
        player.mo.momx = 0
        player.mo.momy = 0
    elseif player.pflags & PF_JUMPED and spiritbomb_cooldown[player] == 0 
           and player.cmd.buttons & BT_CUSTOM2 == 0 then
        -- Release spirit bomb
        local bomb = P_SpawnMobj(player.mo.x, player.mo.y, player.mo.z + 64*FRACUNIT, MT_EGGMOBILE_FIRE)
        bomb.angle = player.mo.angle
        P_InstaThrust(bomb, bomb.angle, 25*FRACUNIT)
        bomb.momz = -8*FRACUNIT
        bomb.scale = 2*FRACUNIT
        bomb.color = SKINCOLOR_AQUA
        
        S_StartSound(player.mo, sfx_s3kb4) -- Explosion sound
        spiritbomb_cooldown[player] = 105 -- 3 second cooldown
    end
    
    -- Enhanced flight ability
    if player.pflags & PF_THOKKED then
        if flight_power[player] > 0 then
            player.mo.momz = 8*FRACUNIT -- Upward thrust
            flight_power[player] = $ - 1
            
            -- Flight particles
            if leveltime % 3 == 0 then
                local trail = P_SpawnMobj(player.mo.x, player.mo.y, player.mo.z, MT_THOK)
                trail.color = SKINCOLOR_ORANGE
                trail.scale = FRACUNIT/2
            end
        end
    else
        -- Regenerate flight power on ground
        if player.mo.eflags & MFE_TOUCHWATER or P_IsObjectOnGround(player.mo) then
            if flight_power[player] < 100 then
                flight_power[player] = $ + 2
            end
        end
    end
end)

-- HUD Display
hud.add(function(v, player)
    if not (player.mo and player.mo.skin == "orangesonic") then return end
    
    local y = 180
    
    -- Kamehameha cooldown
    if kamehameha_cooldown[player] > 0 then
        v.drawString(4, y, "Kamehameha: "..kamehameha_cooldown[player]/TICRATE.."s", V_SNAPTOLEFT|V_SNAPTOBOTTOM, "thin")
        y = $ + 8
    else
        v.drawString(4, y, "Kamehameha: READY", V_SNAPTOLEFT|V_SNAPTOBOTTOM|V_YELLOWMAP, "thin")
        y = $ + 8
    end
    
    -- Spirit Bomb cooldown
    if spiritbomb_cooldown[player] > 0 then
        v.drawString(4, y, "Spirit Bomb: "..spiritbomb_cooldown[player]/TICRATE.."s", V_SNAPTOLEFT|V_SNAPTOBOTTOM, "thin")
        y = $ + 8
    else
        v.drawString(4, y, "Spirit Bomb: READY", V_SNAPTOLEFT|V_SNAPTOBOTTOM|V_CYANMAP, "thin")
        y = $ + 8
    end
    
    -- Flight power
    local color = V_GREENMAP
    if flight_power[player] < 30 then color = V_REDMAP
    elseif flight_power[player] < 60 then color = V_YELLOWMAP end
    
    v.drawString(4, y, "Flight: "..flight_power[player].."%", V_SNAPTOLEFT|V_SNAPTOBOTTOM|color, "thin")
end, "game")`;
  };

  const generatePK3 = () => {
    setDownloading(true);
    
    // Create a simple text file with instructions since we can't create actual PK3 in browser
    const socContent = generateSOCFile();
    const luaContent = generateLuaFile();
    
    const readmeContent = `# ${charName} - Dragon Ball Character for SRB2

## Installation Instructions:

1. This download contains the character definition files
2. To create a proper PK3 file, you'll need to:
   - Create a folder structure: SOC/ and Lua/
   - Place the SOC file in the SOC/ folder
   - Place the Lua file in the Lua/ folder
   - Create character sprites (optional but recommended)
   - Compress everything into a ZIP file
   - Rename the .zip extension to .pk3

## Controls:

- **Custom Button 1**: Kamehameha (energy blast attack)
- **Custom Button 2**: Spirit Bomb (hold to charge, release to fire)
- **Jump twice**: Activate flight mode
- Flight drains energy, recharges on ground

## Character Stats:

- Speed: 36 (Sonic-style speed)
- Jump: Normal
- Color: Orange
- Abilities: Flight with Dragon Ball-style attacks

## Files Included:

1. ${charName.replace(/\s+/g, '')}.soc - Character definition
2. OrangeSonic.lua - Custom ability scripts
3. README.txt - This file

## Notes:

- Kamehameha has 1 second cooldown
- Spirit Bomb has 3 second cooldown
- Flight energy regenerates when on ground or in water
- Character uses orange color scheme

Enjoy your Dragon Ball-powered Sonic character!
`;

    const fullContent = `=== ${charName.replace(/\s+/g, '')}.soc ===

${socContent}

=== Lua/OrangeSonic.lua ===

${luaContent}

=== README.txt ===

${readmeContent}`;

    const blob = new Blob([fullContent], { type: 'text/plain' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = `${charName.replace(/\s+/g, '')}_SRB2_Files.txt`;
    a.click();
    URL.revokeObjectURL(url);
    
    setTimeout(() => setDownloading(false), 1000);
  };

  return (
    <div className="min-h-screen bg-gradient-to-br from-orange-500 via-red-500 to-yellow-500 p-8">
      <div className="max-w-4xl mx-auto">
        <div className="bg-white rounded-lg shadow-2xl p-8">
          <h1 className="text-4xl font-bold text-center mb-2 text-orange-600">
            SRB2 Dragon Ball Character Generator
          </h1>
          <p className="text-center text-gray-600 mb-8">
            Create an Orange Sonic with Kamehameha, Spirit Bomb & Flight!
          </p>

          <div className="mb-8">
            <label className="block text-sm font-bold text-gray-700 mb-2">
              Character Name
            </label>
            <input
              type="text"
              value={charName}
              onChange={(e) => setCharName(e.target.value)}
              className="w-full px-4 py-2 border-2 border-orange-300 rounded-lg focus:outline-none focus:border-orange-500"
              placeholder="Orange Sonic"
            />
          </div>

          <div className="grid md:grid-cols-3 gap-4 mb-8">
            <div className="bg-gradient-to-br from-yellow-100 to-orange-100 p-6 rounded-lg border-2 border-orange-300">
              <Zap className="w-12 h-12 text-yellow-600 mb-3 mx-auto" />
              <h3 className="font-bold text-center text-lg mb-2">Kamehameha</h3>
              <p className="text-sm text-gray-700 text-center">
                Energy blast attack with 1s cooldown
              </p>
            </div>

            <div className="bg-gradient-to-br from-blue-100 to-cyan-100 p-6 rounded-lg border-2 border-cyan-300">
              <div className="w-12 h-12 bg-cyan-500 rounded-full mb-3 mx-auto flex items-center justify-center text-white font-bold text-xl">
                ðŸ’«
              </div>
              <h3 className="font-bold text-center text-lg mb-2">Spirit Bomb</h3>
              <p className="text-sm text-gray-700 text-center">
                Hold to charge, release for massive damage
              </p>
            </div>

            <div className="bg-gradient-to-br from-orange-100 to-red-100 p-6 rounded-lg border-2 border-orange-300">
              <Wind className="w-12 h-12 text-orange-600 mb-3 mx-auto" />
              <h3 className="font-bold text-center text-lg mb-2">Flight</h3>
              <p className="text-sm text-gray-700 text-center">
                Press jump twice to fly with energy system
              </p>
            </div>
          </div>

          <div className="bg-gray-100 rounded-lg p-6 mb-8">
            <h3 className="font-bold text-lg mb-3">Character Features:</h3>
            <ul className="space-y-2 text-gray-700">
              <li>âœ“ Orange-colored Sonic character</li>
              <li>âœ“ Sonic-style speed and movement</li>
              <li>âœ“ Custom Button 1: Kamehameha attack</li>
              <li>âœ“ Custom Button 2: Spirit Bomb (hold to charge)</li>
              <li>âœ“ Flight ability with energy meter</li>
              <li>âœ“ Visual effects for all abilities</li>
              <li>âœ“ Cooldown system for balance</li>
              <li>âœ“ On-screen HUD display</li>
            </ul>
          </div>

          <button
            onClick={generatePK3}
            disabled={downloading}
            className="w-full bg-gradient-to-r from-orange-500 to-red-500 text-white font-bold py-4 px-8 rounded-lg hover:from-orange-600 hover:to-red-600 transition-all transform hover:scale-105 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-3"
          >
            <Download className="w-6 h-6" />
            {downloading ? 'Generating Files...' : 'Download Character Files'}
          </button>

          <div className="mt-6 bg-yellow-50 border-2 border-yellow-300 rounded-lg p-4">
            <p className="text-sm text-gray-700">
              <strong>Note:</strong> This generates the SOC and Lua script files for your character. 
              You'll need to package them into a PK3 file format and optionally add custom sprites. 
              Instructions are included in the download!
            </p>
          </div>
        </div>
      </div>
    </div>
  );
};

export default SRB2CharacterGenerator;
